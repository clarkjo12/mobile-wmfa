'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.map = exports.chain = undefined;

var _waterfall = require('async/waterfall');

var _waterfall2 = _interopRequireDefault(_waterfall);

var _mapSeries = require('async/mapSeries');

var _mapSeries2 = _interopRequireDefault(_mapSeries);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

var chain = exports.chain = function chain() {
  for (var _len = arguments.length, fns = Array(_len), _key = 0; _key < _len; _key++) {
    fns[_key] = arguments[_key];
  }

  return function () {
    for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
      args[_key2] = arguments[_key2];
    }

    var lastArg = args.slice(-1)[0];
    var nextFunc = typeof lastArg === 'function' ? lastArg : function () {};
    var initArgs = args.slice(0, -1);
    var waterFns = initArgs.length > 0 ? [function (next) {
      return next.apply(undefined, [undefined].concat(_toConsumableArray(initArgs)));
    }].concat(fns) : fns;
    (0, _waterfall2.default)(waterFns, nextFunc);
  };
};

var map = exports.map = function map() {
  for (var _len3 = arguments.length, fns = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
    fns[_key3] = arguments[_key3];
  }

  return function (collection, done) {
    var iteree = function iteree(val, next) {
      return chain.apply(undefined, fns)(val, function (err, out) {
        return next(null, out);
      });
    };
    (0, _mapSeries2.default)(collection, iteree, done);
  };
};